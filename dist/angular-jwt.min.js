!function(){angular.module("angular-jwt",["angular-jwt.interceptor","angular-jwt.jwt","angular-jwt.authManager"]),angular.module("angular-jwt.authManager",[]).provider("authManager",function(){this.authenticated=!1,this.loginPath="/",this.tokenGetter=function(){return null},this.unauthenticatedRedirector=function(e){e.path(this.loginPath)};var e=this;this.$get=["$rootScope","$location","jwtHelper","jwtInterceptor",function(t,r,n){function a(){return u}function o(){var a="$locationChangeStart";t.$on(a,function(){var t=e.tokenGetter();t?n.isTokenExpired(t)||(u=!0):(u=!1,e.unauthenticatedRedirector(r))})}function i(){t.$on("unauthenticated",function(){e.unauthenticatedRedirector(r)})}var u=!1;return{isAuthenticated:a,checkAuthOnRefresh:o,redirectWhenUnauthenticated:i}}]}),angular.module("angular-jwt.interceptor",[]).provider("jwtInterceptor",function(){this.urlParam=null,this.authHeader="Authorization",this.authPrefix="Bearer ",this.whiteListedDomains=[],this.tokenGetter=function(){return null};var e=this;this.$get=["$q","$injector","$rootScope","urlUtils",function(t,r,n,a){function o(t){for(var r=a.urlResolve(t).hostname.toLowerCase(),n=0;n<e.whiteListedDomains.length;n++){var o=e.whiteListedDomains[n].toLowerCase();if(o===r)return!0}return a.isSameOrigin(t)?!0:!1}return{request:function(n){if(n.skipAuthorization||!o(n.url))return n;if(e.urlParam){if(n.params=n.params||{},n.params[e.urlParam])return n}else if(n.headers=n.headers||{},n.headers[e.authHeader])return n;var a=t.when(r.invoke(e.tokenGetter,this,{config:n}));return a.then(function(t){return t&&(e.urlParam?n.params[e.urlParam]=t:n.headers[e.authHeader]=e.authPrefix+t),n})},responseError:function(e){return 401===e.status&&n.$broadcast("unauthenticated",e),t.reject(e)}}}]}),angular.module("angular-jwt.jwt",[]).service("jwtHelper",["$window",function(e){this.urlBase64Decode=function(t){var r=t.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw"Illegal base64url string!"}return e.decodeURIComponent(escape(e.atob(r)))},this.decodeToken=function(e){var t=e.split(".");if(3!==t.length)throw new Error("JWT must have 3 parts");var r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token");return angular.fromJson(r)},this.getTokenExpirationDate=function(e){var t=this.decodeToken(e);if("undefined"==typeof t.exp)return null;var r=new Date(0);return r.setUTCSeconds(t.exp),r},this.isTokenExpired=function(e,t){var r=this.getTokenExpirationDate(e);return t=t||0,null===r?!1:!(r.valueOf()>(new Date).valueOf()+1e3*t)}}]),angular.module("angular-jwt.interceptor").service("urlUtils",function(){function e(e){var t=e;return r.setAttribute("href",t),t=r.href,r.setAttribute("href",t),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}function t(t){var r=angular.isString(t)?e(t):t;return r.protocol===n.protocol&&r.host===n.host}var r=document.createElement("a"),n=e(window.location.href);return{urlResolve:e,isSameOrigin:t}})}();